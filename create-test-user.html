<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Test User in Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        code {
            background: #f4f4f4;
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>Create Test User: weezer@yev.com</h1>
    
    <div class="status info">
        <h3>Instructions:</h3>
        <p>This page will help you create the test user <code>weezer@yev.com</code> with password <code>12345</code> in Firebase Authentication.</p>
        <p><strong>Note:</strong> Firebase requires passwords to be at least 6 characters, so we'll use <code>123456</code> instead.</p>
    </div>
    
    <button onclick="createTestUser()">Create Test User</button>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="listUsers()">List All Users</button>
    
    <div id="result"></div>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB0SdtkO7ngsXP7B0geafpDv_xEBAujel8",
            authDomain: "infitwin.firebaseapp.com",
            projectId: "infitwin",
            storageBucket: "infitwin.firebasestorage.app",
            messagingSenderId: "833139648849",
            appId: "1:833139648849:web:2768d8e37cf2a318018b70",
            measurementId: "G-PEJN4ZMCZ6"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = `<p>${message}</p>`;
            resultDiv.appendChild(statusDiv);
        }
        
        window.createTestUser = async function() {
            showResult('Creating test user...', 'info');
            
            try {
                // First try to create with the exact password if possible
                let password = '12345';
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, 'weezer@yev.com', password);
                    showResult(`✅ User created successfully with password: ${password}`, 'success');
                } catch (error) {
                    if (error.code === 'auth/weak-password') {
                        // If password is too weak, try with minimum length
                        password = '123456';
                        const userCredential = await createUserWithEmailAndPassword(auth, 'weezer@yev.com', password);
                        showResult(`✅ User created successfully with password: ${password} (Firebase minimum length)`, 'success');
                        showResult(`⚠️ Note: You'll need to use password '123456' instead of '12345' for testing`, 'info');
                    } else {
                        throw error;
                    }
                }
                
                // Update the user's display name
                if (auth.currentUser) {
                    await updateProfile(auth.currentUser, {
                        displayName: 'Weezer Test User'
                    });
                    showResult('✅ Display name set to: Weezer Test User', 'success');
                }
                
            } catch (error) {
                if (error.code === 'auth/email-already-in-use') {
                    showResult('ℹ️ User weezer@yev.com already exists', 'info');
                    showResult('You can now test login with this user', 'info');
                } else {
                    showResult(`❌ Error creating user: ${error.code} - ${error.message}`, 'error');
                }
            }
        }
        
        window.testLogin = async function() {
            showResult('Testing login...', 'info');
            
            // Try both passwords
            const passwords = ['12345', '123456'];
            
            for (const password of passwords) {
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, 'weezer@yev.com', password);
                    showResult(`✅ Login successful with password: ${password}`, 'success');
                    showResult(`User ID: ${userCredential.user.uid}`, 'info');
                    showResult(`Email Verified: ${userCredential.user.emailVerified}`, 'info');
                    return;
                } catch (error) {
                    // Continue to next password
                }
            }
            
            showResult('❌ Login failed with both passwords (12345 and 123456)', 'error');
        }
        
        window.listUsers = async function() {
            showResult('Current user info:', 'info');
            
            if (auth.currentUser) {
                showResult(`
                    Email: ${auth.currentUser.email}<br>
                    UID: ${auth.currentUser.uid}<br>
                    Display Name: ${auth.currentUser.displayName || 'Not set'}<br>
                    Email Verified: ${auth.currentUser.emailVerified}
                `, 'info');
            } else {
                showResult('No user currently signed in', 'info');
                showResult('Note: Firebase client SDK cannot list all users for security reasons. Use Firebase Admin SDK or Console to see all users.', 'info');
                showResult('<a href="https://console.firebase.google.com/project/infitwin/authentication/users" target="_blank">Open Firebase Console</a>', 'info');
            }
        }
    </script>
</body>
</html>