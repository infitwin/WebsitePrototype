<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Infitwin Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/components/navigation.css">
    <link rel="stylesheet" href="../css/pages/settings.css">
</head>
<body class="settings-container">
    <div class="symphony-dashboard">
        <!-- Sidebar Navigation -->
        <div class="sidebar-nav-container"></div>
        
        <!-- Main Content Wrapper -->
        <div class="main-content-wrapper">
            <!-- Navigation -->
            <nav class="dashboard-nav">
                <div class="nav-container">
                    <div class="nav-left">
                        <img src="../assets/images/infitwin-logo.jpg" alt="Infitwin" class="nav-logo">
                        <h1 class="nav-title">Settings</h1>
                    </div>
                    <div class="nav-right">
                        <button class="nav-button notifications">
                            <span class="notification-icon">ðŸ””</span>
                            <span class="notification-badge">3</span>
                        </button>
                        <div id="userMenuContainer"></div>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="dashboard-main symphony-content">
                <!-- Page Header -->
                <header class="page-header">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Manage your account settings and preferences</p>
                </header>

                <!-- Profile Section -->
                <section class="settings-section profile-section" data-section="profile">
                    <div class="section-header">
                        <h2 class="section-title">Profile</h2>
                        <p class="section-description">Update your personal information and account details</p>
                    </div>

                    <form id="accountForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="displayName">Display Name</label>
                                <input type="text" class="infitwin-form__input" id="displayName" value="John Doe" data-validate="required">
                                <div class="form-help">Used across Infitwin</div>
                                <div class="form-error"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="emailAddress">Email Address</label>
                                <div class="email-container">
                                    <input type="email" class="infitwin-form__input" id="emailAddress" value="john.doe@email.com" data-validate="email">
                                    <span class="verification-badge">âœ“ Verified</span>
                                </div>
                                <div class="form-help">We'll email to verify any changes</div>
                                <div class="form-error"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="phoneNumber">Phone Number</label>
                                <input type="tel" class="infitwin-form__input" id="phoneNumber" value="+1 (555) 123-4567" data-validate="phone">
                                <div class="form-help">Optional - for account recovery</div>
                                <div class="form-error"></div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="timezone">Timezone</label>
                                <select class="infitwin-form__input" id="timezone">
                                    <option value="America/New_York">Eastern Time (ET)</option>
                                    <option value="America/Chicago">Central Time (CT)</option>
                                    <option value="America/Denver">Mountain Time (MT)</option>
                                    <option value="America/Los_Angeles" selected>Pacific Time (PT)</option>
                                </select>
                                <div class="form-error">Please select a valid timezone</div>
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="saveAccountBtn">Save Changes</button>
                            <button type="button" id="cancelAccountBtn">Cancel</button>
                        </div>
                    </form>
                </section>

                <!-- Account Settings Section -->
                <section class="settings-section account-settings-section" data-section="account">
                    <div class="section-header">
                        <h2 class="section-title">Account Settings</h2>
                        <p class="section-description">Manage your account, billing, and subscription settings</p>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Subscription Status</div>
                                <div class="toggle-description">Current plan: Free Tier (10GB storage limit)</div>
                            </div>
                            <button id="upgradePlanBtn">Upgrade Plan</button>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Storage Usage</div>
                                <div class="toggle-description">3.5 GB of 10 GB used (35%)</div>
                            </div>
                            <div style="width: 120px; height: 8px; background: var(--color-border); border-radius: 4px; overflow: hidden;">
                                <div style="width: 35%; height: 100%; background: linear-gradient(135deg, var(--color-warning) 0%, #FFC107 100%);"></div>
                            </div>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Account Created</div>
                                <div class="toggle-description">December 15, 2024</div>
                            </div>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Data Export</div>
                                <div class="toggle-description">Download all your memories, transcripts, and settings</div>
                            </div>
                            <button id="exportDataBtn">Export Data</button>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Delete Account</div>
                                <div class="toggle-description">Permanently delete your account and all associated data</div>
                            </div>
                            <button id="deleteAccountBtn">Delete Account</button>
                        </div>
                    </div>
                </section>

                <!-- Security Section -->
                <section class="settings-section">
                    <div class="section-header">
                        <h2 class="section-title">Security</h2>
                        <p class="section-description">Manage your password and security settings</p>
                    </div>

                    <form id="securityForm" novalidate>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label class="form-label" for="currentPassword">Current Password</label>
                                <input type="password" class="infitwin-form__input" id="currentPassword" placeholder="Enter current password" data-validate="required">
                                <div class="form-error">Current password is required</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="newPassword">New Password</label>
                                <input type="password" class="infitwin-form__input" id="newPassword" placeholder="Enter new password" data-validate="required">
                                <div class="form-help">At least 8 characters</div>
                                <div class="form-error">Password validation error</div>
                                <div class="password-strength" id="passwordStrength">
                                    <div class="strength-bar">
                                        <div class="strength-fill"></div>
                                    </div>
                                    <div class="strength-text">Password strength</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="confirmPassword">Confirm Password</label>
                                <input type="password" class="infitwin-form__input" id="confirmPassword" placeholder="Confirm new password" data-validate="required">
                                <div class="form-error" id="passwordMismatch">Passwords do not match</div>
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="changePasswordBtn">Change Password</button>
                            <button type="button" id="cancelPasswordBtn">Cancel</button>
                        </div>
                    </form>
                    
                    <!-- Logout Section -->
                    <div class="logout-section">
                        <h3 style="font-size: 16px; font-weight: 600; color: var(--color-text-primary); margin-bottom: 8px;">Sign Out</h3>
                        <p style="font-size: 14px; color: var(--color-text-secondary); margin-bottom: 16px;">Sign out of your Infitwin account on this device</p>
                        <button type="button" id="logoutBtn">Sign Out</button>
                    </div>
                </section>

                <!-- Preferences Section -->
                <section class="settings-section preferences-section" data-section="preferences">
                    <div class="section-header">
                        <h2 class="section-title">Preferences</h2>
                        <p class="section-description">Customize your interface, language, and application preferences</p>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Theme</div>
                                <div class="toggle-description">Choose your preferred color scheme</div>
                            </div>
                            <select class="infitwin-form__input" id="themePreference" style="width: 150px;">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto (System)</option>
                            </select>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Language</div>
                                <div class="toggle-description">Select your preferred language</div>
                            </div>
                            <select class="infitwin-form__input" id="languagePreference" style="width: 150px;">
                                <option value="en" selected>English</option>
                                <option value="es">EspaÃ±ol</option>
                                <option value="fr">FranÃ§ais</option>
                                <option value="de">Deutsch</option>
                                <option value="zh">ä¸­æ–‡</option>
                            </select>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Date Format</div>
                                <div class="toggle-description">How dates are displayed throughout the app</div>
                            </div>
                            <select class="infitwin-form__input" id="dateFormat" style="width: 150px;">
                                <option value="mdy">MM/DD/YYYY</option>
                                <option value="dmy">DD/MM/YYYY</option>
                                <option value="ymd">YYYY-MM-DD</option>
                                <option value="relative">Relative (2 days ago)</option>
                            </select>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Auto-Save Interviews</div>
                                <div class="toggle-description">Automatically save interview responses as you type</div>
                            </div>
                            <label class="toggle-switch active" data-setting="autoSaveInterviews">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Compact View</div>
                                <div class="toggle-description">Use a denser layout to show more content</div>
                            </div>
                            <label class="toggle-switch" data-setting="compactView">
                                <input type="checkbox" class="toggle-input">
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Animation Effects</div>
                                <div class="toggle-description">Enable smooth transitions and animations</div>
                            </div>
                            <label class="toggle-switch active" data-setting="animationEffects">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Sound Effects</div>
                                <div class="toggle-description">Play sounds for notifications and interactions</div>
                            </div>
                            <label class="toggle-switch" data-setting="soundEffects">
                                <input type="checkbox" class="toggle-input">
                            </label>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" id="savePreferencesBtn">Save Preferences</button>
                        <button type="button" id="resetPreferencesBtn">Reset to Defaults</button>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section class="settings-section notification-section" data-section="notifications">
                    <div class="section-header">
                        <h2 class="section-title">Notifications</h2>
                        <p class="section-description">Control how and when you receive notifications</p>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Email Notifications</div>
                                <div class="toggle-description">Receive general updates and announcements via email</div>
                            </div>
                            <label class="toggle-switch active" data-setting="emailNotifications">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Interview Reminders</div>
                                <div class="toggle-description">Get reminded to continue building your twin through interviews</div>
                            </div>
                            <label class="toggle-switch active" data-setting="interviewReminders">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Weekly Digest</div>
                                <div class="toggle-description">Receive a weekly summary of your memory building progress</div>
                            </div>
                            <label class="toggle-switch" data-setting="weeklyDigest">
                                <input type="checkbox" class="toggle-input">
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Shared Twin Alerts</div>
                                <div class="toggle-description">Get notified when someone shares their twin with you</div>
                            </div>
                            <label class="toggle-switch active" data-setting="sharedTwinAlerts">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- Privacy Section -->
                <section class="settings-section privacy-section" data-section="privacy">
                    <div class="section-header">
                        <h2 class="section-title">Privacy</h2>
                        <p class="section-description">Control your privacy and data sharing preferences</p>
                    </div>

                    <div class="toggle-group">
                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Profile Visibility</div>
                                <div class="toggle-description">Allow others to find your profile when sharing twins</div>
                            </div>
                            <label class="toggle-switch active" data-setting="profileVisibility">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Analytics</div>
                                <div class="toggle-description">Help improve Infitwin by sharing anonymous usage data</div>
                            </div>
                            <label class="toggle-switch active" data-setting="analytics">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>

                        <div class="toggle-item">
                            <div class="toggle-info">
                                <div class="toggle-label">Memory Suggestions</div>
                                <div class="toggle-description">Allow AI to suggest memory topics based on your existing content</div>
                            </div>
                            <label class="toggle-switch active" data-setting="memorySuggestions">
                                <input type="checkbox" class="toggle-input" checked>
                            </label>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" id="downloadDataBtn">Download My Data</button>
                        <button type="button" id="deleteAccountBtn2">Delete Account</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMessage">
        Settings saved successfully!
    </div>

    <!-- Firebase SDK v8 Compatibility -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- Initialize Firebase -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB0SdtkO7ngsXP7B0geafpDv_xEBAujel8",
            authDomain: "infitwin.firebaseapp.com",
            projectId: "infitwin",
            storageBucket: "infitwin.firebasestorage.app",
            messagingSenderId: "833139648849",
            appId: "1:833139648849:web:2768d8e37cf2a318018b70",
            measurementId: "G-PEJN4ZMCZ6"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        console.log('Firebase initialized for settings');
        const auth = firebase.auth();
    </script>

    <script src="../js/navigation.js"></script>
    <script type="module">
        import { initializeSettings } from '../js/pages/settings.js';
        import { guardPage } from '../js/auth-guard.js';
        import { UserMenu } from '../js/components/ui/user-menu.js';
        import { Button } from '../js/components/ui/button.js';
        
        // Guard the page
        guardPage();
        
        // Initialize user menu
        const userMenuContainer = document.getElementById('userMenuContainer');
        const userMenu = new UserMenu({
            userName: localStorage.getItem('userName') || 'John Doe',
            userAvatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(localStorage.getItem('userName') || 'John Doe')}&background=FFD700&color=2C1810`
        });
        userMenuContainer.appendChild(userMenu.element);
        
        // Initialize settings functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeSettings();
            
            // Setup additional button replacements
            const buttonReplacements = [
                { id: 'cancelAccountBtn', config: { text: 'Cancel', type: 'secondary' } },
                { id: 'upgradePlanBtn', config: { text: 'Upgrade Plan', type: 'secondary', size: 'small' } },
                { id: 'exportDataBtn', config: { text: 'Export Data', type: 'secondary', size: 'small' } },
                { id: 'deleteAccountBtn', config: { text: 'Delete Account', type: 'danger', size: 'small' } },
                { id: 'cancelPasswordBtn', config: { text: 'Cancel', type: 'secondary' } },
                { id: 'resetPreferencesBtn', config: { text: 'Reset to Defaults', type: 'secondary' } },
                { id: 'downloadDataBtn', config: { text: 'Download My Data', type: 'tertiary' } },
                { id: 'deleteAccountBtn2', config: { text: 'Delete Account', type: 'tertiary' } }
            ];
            
            buttonReplacements.forEach(({ id, config }) => {
                const oldBtn = document.getElementById(id);
                if (oldBtn) {
                    const newBtn = new Button(config);
                    oldBtn.replaceWith(newBtn.element);
                    
                    // Re-attach event handlers based on button ID
                    switch(id) {
                        case 'cancelAccountBtn':
                            newBtn.element.addEventListener('click', () => {
                                document.getElementById('accountForm').reset();
                            });
                            break;
                        case 'resetPreferencesBtn':
                            newBtn.element.addEventListener('click', () => {
                                // Reset preferences logic handled in settings.js
                            });
                            break;
                        // Add other button handlers as needed
                    }
                }
            });
        });
    </script>
</body>
</html>