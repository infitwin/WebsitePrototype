<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore - Infitwin Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/dashboard.css">
    <style>
        /* Explore Screen Specific Styles */
        .explore-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Minimal Navigation */
        .explore-nav {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            z-index: 200;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .explore-title {
            font-size: 24px;
            font-weight: 600;
            color: white;
            margin: 0;
        }

        .mode-indicator {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.5);
            color: #FFD700;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Main Explore Layout */
        .explore-main {
            position: absolute;
            top: 64px;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
        }

        /* Graph Visualization Area */
        .graph-container {
            flex: 1;
            position: relative;
            background: rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .graph-placeholder {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .graph-content {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }

        .graph-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .graph-text {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .graph-subtext {
            font-size: 14px;
            opacity: 0.7;
        }

        /* Memory Nodes (placeholder) */
        .memory-node {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #FFD700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2C1810;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .memory-node:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }

        .memory-node.person { background: #EC4899; color: white; }
        .memory-node.place { background: #10B981; color: white; }
        .memory-node.event { background: #3B82F6; color: white; }

        /* Connection lines (placeholder) */
        .connection-line {
            position: absolute;
            height: 2px;
            background: rgba(255, 215, 0, 0.3);
            transform-origin: left center;
            pointer-events: none;
        }

        /* Winston Panel */
        .winston-panel {
            width: 400px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .winston-panel.collapsed {
            transform: translateX(100%);
        }

        .winston-header {
            padding: 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .winston-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .winston-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .winston-details h3 {
            font-size: 18px;
            font-weight: 600;
            color: #2C1810;
            margin: 0 0 4px 0;
        }

        .winston-status {
            font-size: 14px;
            color: #6B7280;
            margin: 0;
        }

        .panel-toggle {
            background: none;
            border: none;
            font-size: 20px;
            color: #6B7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        .panel-toggle:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        /* Winston Chat Area */
        .winston-chat {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            max-height: calc(100vh - 240px);
        }

        .chat-message {
            margin-bottom: 16px;
            display: flex;
            flex-direction: column;
        }

        .message-bubble {
            background: #F3F4F6;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #374151;
            max-width: 280px;
        }

        .winston-message .message-bubble {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
        }

        .message-time {
            font-size: 11px;
            color: #9CA3AF;
            margin-top: 4px;
            margin-left: 16px;
        }

        /* Winston Input */
        .winston-input {
            padding: 20px 24px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .input-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 100px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #8B5CF6;
        }

        .send-btn {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* Suggestion Chips */
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .suggestion-chip {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #7C3AED;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-chip:hover {
            background: rgba(139, 92, 246, 0.2);
        }

        /* Controls Toolbar */
        .controls-toolbar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 12px;
            z-index: 150;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 8px;
            display: flex;
            gap: 4px;
        }

        .control-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .control-btn.active {
            background: #FFD700;
            color: white;
        }

        /* Filters Panel */
        .filters-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            min-width: 200px;
            z-index: 150;
        }

        .filter-section {
            margin-bottom: 16px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .filter-chip {
            background: rgba(0, 0, 0, 0.1);
            color: #374151;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: #FFD700;
            color: white;
        }

        .filter-chip:hover:not(.active) {
            background: rgba(0, 0, 0, 0.2);
        }

        /* Time Slider */
        .time-slider {
            position: absolute;
            bottom: 20px;
            right: 440px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            min-width: 300px;
            z-index: 150;
        }

        .slider-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            text-align: center;
        }

        .slider-container {
            position: relative;
        }

        .time-range {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #E5E7EB;
            appearance: none;
            outline: none;
        }

        .time-range::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFD700;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .time-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 11px;
            color: #6B7280;
        }

        /* Node Preview Popover */
        .node-preview {
            position: absolute;
            background: white;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 16px;
            min-width: 200px;
            max-width: 300px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 300;
            display: none;
        }

        .preview-title {
            font-size: 16px;
            font-weight: 600;
            color: #2C1810;
            margin-bottom: 8px;
        }

        .preview-content {
            font-size: 14px;
            color: #6B7280;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .preview-actions {
            display: flex;
            gap: 8px;
        }

        .preview-btn {
            background: none;
            border: 1px solid #E5E7EB;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preview-btn:hover {
            background: #F3F4F6;
        }

        .preview-btn.primary {
            background: #FFD700;
            border-color: #FFD700;
            color: white;
        }

        .preview-btn.primary:hover {
            background: #FFC107;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .explore-nav {
                padding: 0 16px;
            }

            .winston-panel {
                width: 100%;
                position: absolute;
                top: 0;
                bottom: 0;
                right: 0;
                z-index: 250;
            }

            .winston-panel.collapsed {
                transform: translateX(100%);
            }

            .controls-toolbar {
                left: 10px;
                bottom: 10px;
            }

            .time-slider {
                right: 10px;
                bottom: 70px;
                min-width: 250px;
            }

            .filters-panel {
                right: 10px;
                top: 70px;
                min-width: 180px;
            }

            .control-group {
                padding: 6px;
            }

            .control-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body class="explore-container">
    <!-- Minimal Navigation -->
    <nav class="explore-nav">
        <div class="nav-left">
            <a href="dashboard.html" class="back-btn">
                <span>‚Üê</span>
                Back to Dashboard
            </a>
            <h1 class="explore-title">Explore Your Memories</h1>
        </div>
        <div class="mode-indicator">Winston Curator Mode</div>
    </nav>

    <!-- Main Explore Area -->
    <main class="explore-main">
        <!-- Graph Visualization -->
        <section class="graph-container" id="graphContainer">
            <div class="graph-placeholder">
                <div class="graph-content">
                    <div class="graph-icon">üåê</div>
                    <div class="graph-text">Memory Graph Loading...</div>
                    <div class="graph-subtext">Neo4j visualization will appear here</div>
                </div>
            </div>

            <!-- Sample Memory Nodes (placeholder) -->
            <div class="memory-node" style="top: 20%; left: 30%;" title="Family Photo">üì∏</div>
            <div class="memory-node person" style="top: 40%; left: 60%;" title="Grandmother">üëµ</div>
            <div class="memory-node place" style="top: 60%; left: 20%;" title="Childhood Home">üè†</div>
            <div class="memory-node event" style="top: 30%; left: 70%;" title="Wedding Day">üíí</div>
            <div class="memory-node" style="top: 70%; left: 50%;" title="School Days">üéì</div>

            <!-- Sample Connection Lines -->
            <div class="connection-line" style="top: 22%; left: 32%; width: 180px; transform: rotate(15deg);"></div>
            <div class="connection-line" style="top: 42%; left: 35%; width: 150px; transform: rotate(-20deg);"></div>
            <div class="connection-line" style="top: 62%; left: 25%; width: 200px; transform: rotate(45deg);"></div>

            <!-- Node Preview Popover -->
            <div class="node-preview" id="nodePreview">
                <div class="preview-title">Family Photo</div>
                <div class="preview-content">Christmas morning 1995 - The whole family gathered around the tree. Connected to 3 other memories about holidays and family traditions.</div>
                <div class="preview-actions">
                    <button class="preview-btn primary">Explore</button>
                    <button class="preview-btn">Add Context</button>
                </div>
            </div>
        </section>

        <!-- Winston Panel -->
        <aside class="winston-panel" id="winstonPanel">
            <header class="winston-header">
                <div class="winston-info">
                    <div class="winston-avatar">üß†</div>
                    <div class="winston-details">
                        <h3>Winston</h3>
                        <p class="winston-status">Memory Curator</p>
                    </div>
                </div>
                <button class="panel-toggle" onclick="toggleWinstonPanel()">‚Üí</button>
            </header>

            <div class="winston-chat" id="winstonChat">
                <!-- Suggestion Chips -->
                <div class="suggestion-chips">
                    <div class="suggestion-chip" onclick="askWinston('Show me family memories')">Family</div>
                    <div class="suggestion-chip" onclick="askWinston('Find travel memories')">Travel</div>
                    <div class="suggestion-chip" onclick="askWinston('Surprise me')">Surprise Me</div>
                </div>

                <!-- Chat Messages -->
                <div class="chat-message winston-message">
                    <div class="message-bubble">
                        Welcome to your memory universe! I can see you have 47 memories with beautiful connections. What would you like to explore first?
                    </div>
                    <div class="message-time">Just now</div>
                </div>

                <div class="chat-message winston-message">
                    <div class="message-bubble">
                        I notice some interesting patterns in your family memories. Would you like me to show you how your childhood experiences connect to your adult relationships?
                    </div>
                    <div class="message-time">Just now</div>
                </div>
            </div>

            <div class="winston-input">
                <div class="input-container">
                    <textarea class="chat-input" id="chatInput" placeholder="Ask Winston about your memories..." rows="1"></textarea>
                    <button class="send-btn" onclick="sendMessage()">‚Üí</button>
                </div>
            </div>
        </aside>
    </main>

    <!-- Controls Toolbar -->
    <div class="controls-toolbar">
        <div class="control-group">
            <button class="control-btn" title="Zoom In" onclick="zoomIn()">üîç</button>
            <button class="control-btn" title="Zoom Out" onclick="zoomOut()">üîé</button>
            <button class="control-btn" title="Reset View" onclick="resetView()">üéØ</button>
        </div>
        <div class="control-group">
            <button class="control-btn" title="Pan Mode" onclick="togglePanMode()">‚úã</button>
            <button class="control-btn active" title="Select Mode" onclick="toggleSelectMode()">üëÜ</button>
        </div>
        <div class="control-group">
            <button class="control-btn" title="Filters" onclick="toggleFilters()">üéõÔ∏è</button>
            <button class="control-btn" title="Time Travel" onclick="toggleTimeSlider()">‚è∞</button>
        </div>
    </div>

    <!-- Filters Panel -->
    <div class="filters-panel" id="filtersPanel" style="display: none;">
        <div class="filter-section">
            <div class="filter-title">Memory Types</div>
            <div class="filter-chips">
                <div class="filter-chip active">All</div>
                <div class="filter-chip">Photos</div>
                <div class="filter-chip">Stories</div>
                <div class="filter-chip">Events</div>
            </div>
        </div>
        <div class="filter-section">
            <div class="filter-title">People</div>
            <div class="filter-chips">
                <div class="filter-chip active">Everyone</div>
                <div class="filter-chip">Family</div>
                <div class="filter-chip">Friends</div>
                <div class="filter-chip">Colleagues</div>
            </div>
        </div>
        <div class="filter-section">
            <div class="filter-title">Places</div>
            <div class="filter-chips">
                <div class="filter-chip active">Everywhere</div>
                <div class="filter-chip">Home</div>
                <div class="filter-chip">Work</div>
                <div class="filter-chip">Travel</div>
            </div>
        </div>
    </div>

    <!-- Time Slider -->
    <div class="time-slider" id="timeSlider" style="display: none;">
        <div class="slider-title">Time Period</div>
        <div class="slider-container">
            <input type="range" class="time-range" id="timeRange" min="0" max="100" value="100">
            <div class="time-labels">
                <span>1980s</span>
                <span>Today</span>
            </div>
        </div>
    </div>

    <!-- TODO: Neo4j graph component will be integrated here -->
    <!-- TODO: Winston AI chat API integration point -->
    <!-- TODO: Memory node click handlers for graph navigation -->
    <!-- TODO: Real-time graph updates and filtering -->

    <script>
        // Explore Screen JavaScript Functionality
        let winstonPanelOpen = true;
        let currentZoom = 1;
        let panMode = false;
        let filtersOpen = false;
        let timeSliderOpen = false;
        let selectedNodes = new Set();

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeExploreScreen();
            setupEventListeners();
        });

        function initializeExploreScreen() {
            console.log('Explore Screen initialized');
            
            // Simulate graph loading
            setTimeout(() => {
                simulateGraphLoad();
            }, 2000);
            
            // Setup chat input auto-resize
            setupChatInput();
        }

        function setupEventListeners() {
            // Memory node interactions
            const memoryNodes = document.querySelectorAll('.memory-node');
            memoryNodes.forEach(node => {
                node.addEventListener('click', handleNodeClick);
                node.addEventListener('mouseenter', showNodePreview);
                node.addEventListener('mouseleave', hideNodePreview);
            });

            // Graph container interactions
            const graphContainer = document.getElementById('graphContainer');
            graphContainer.addEventListener('click', handleGraphClick);

            // Time slider
            const timeRange = document.getElementById('timeRange');
            timeRange.addEventListener('input', handleTimeChange);

            // Filter chips
            const filterChips = document.querySelectorAll('.filter-chip');
            filterChips.forEach(chip => {
                chip.addEventListener('click', handleFilterClick);
            });

            // Chat input enter key
            const chatInput = document.getElementById('chatInput');
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        // Winston Panel Functions
        function toggleWinstonPanel() {
            const panel = document.getElementById('winstonPanel');
            const toggle = panel.querySelector('.panel-toggle');
            
            winstonPanelOpen = !winstonPanelOpen;
            
            if (winstonPanelOpen) {
                panel.classList.remove('collapsed');
                toggle.textContent = '‚Üí';
            } else {
                panel.classList.add('collapsed');
                toggle.textContent = '‚Üê';
            }
        }

        function askWinston(question) {
            addUserMessage(question);
            
            // Simulate Winston response
            setTimeout(() => {
                let response = '';
                switch(question) {
                    case 'Show me family memories':
                        response = "I found 23 family memories! Let me highlight the connections between your childhood home, family gatherings, and the people who shaped your early years.";
                        break;
                    case 'Find travel memories':
                        response = "Your travel memories span 15 different countries! I can see how each journey influenced your perspective. Shall we start with your first international trip?";
                        break;
                    case 'Surprise me':
                        response = "Here's something fascinating: Your memory about learning to cook from your grandmother connects to 8 other memories, including recent dinner parties. Food has been a constant thread in your relationships!";
                        break;
                    default:
                        response = "That's an interesting question! Let me explore your memory graph to find relevant connections.";
                }
                addWinstonMessage(response);
            }, 1500);
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addUserMessage(message);
                input.value = '';
                input.style.height = 'auto';
                
                // Simulate Winston processing
                setTimeout(() => {
                    const responses = [
                        "I'm analyzing your memory connections for that query. Let me show you what I found...",
                        "That reminds me of several interconnected memories in your graph. Here's what stands out:",
                        "Interesting! I can see patterns in your memories that relate to this. Let me highlight them for you.",
                        "That memory has some beautiful connections to other experiences. Would you like me to explore them together?"
                    ];
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    addWinstonMessage(response);
                }, 1200);
            }
        }

        function addUserMessage(message) {
            const chatArea = document.getElementById('winstonChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message user-message';
            messageDiv.innerHTML = `
                <div class="message-bubble" style="background: #FFD700; color: #2C1810; margin-left: auto;">${message}</div>
                <div class="message-time" style="text-align: right;">Just now</div>
            `;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function addWinstonMessage(message) {
            const chatArea = document.getElementById('winstonChat');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message winston-message';
            messageDiv.innerHTML = `
                <div class="message-bubble">${message}</div>
                <div class="message-time">Just now</div>
            `;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function setupChatInput() {
            const input = document.getElementById('chatInput');
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        }

        // Graph Control Functions
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            applyZoom();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.3);
            applyZoom();
        }

        function resetView() {
            currentZoom = 1;
            applyZoom();
            // Reset pan position
            console.log('View reset');
        }

        function applyZoom() {
            const graphContent = document.querySelector('.graph-placeholder');
            graphContent.style.transform = `scale(${currentZoom})`;
        }

        function togglePanMode() {
            panMode = !panMode;
            const panBtn = document.querySelector('[onclick="togglePanMode()"]');
            const selectBtn = document.querySelector('[onclick="toggleSelectMode()"]');
            
            if (panMode) {
                panBtn.classList.add('active');
                selectBtn.classList.remove('active');
                document.body.style.cursor = 'grab';
            } else {
                panBtn.classList.remove('active');
                document.body.style.cursor = 'default';
            }
        }

        function toggleSelectMode() {
            panMode = false;
            const panBtn = document.querySelector('[onclick="togglePanMode()"]');
            const selectBtn = document.querySelector('[onclick="toggleSelectMode()"]');
            
            panBtn.classList.remove('active');
            selectBtn.classList.add('active');
            document.body.style.cursor = 'default';
        }

        function toggleFilters() {
            filtersOpen = !filtersOpen;
            const panel = document.getElementById('filtersPanel');
            const btn = document.querySelector('[onclick="toggleFilters()"]');
            
            if (filtersOpen) {
                panel.style.display = 'block';
                btn.classList.add('active');
            } else {
                panel.style.display = 'none';
                btn.classList.remove('active');
            }
        }

        function toggleTimeSlider() {
            timeSliderOpen = !timeSliderOpen;
            const slider = document.getElementById('timeSlider');
            const btn = document.querySelector('[onclick="toggleTimeSlider()"]');
            
            if (timeSliderOpen) {
                slider.style.display = 'block';
                btn.classList.add('active');
            } else {
                slider.style.display = 'none';
                btn.classList.remove('active');
            }
        }

        // Node Interaction Functions
        function handleNodeClick(e) {
            e.stopPropagation();
            const node = e.target;
            const nodeId = node.getAttribute('title');
            
            if (selectedNodes.has(nodeId)) {
                selectedNodes.delete(nodeId);
                node.style.transform = '';
            } else {
                selectedNodes.add(nodeId);
                node.style.transform = 'scale(1.3)';
            }
            
            console.log('Node clicked:', nodeId);
            
            // Simulate Winston commenting on selection
            if (selectedNodes.size === 1) {
                setTimeout(() => {
                    addWinstonMessage(`I see you're interested in "${nodeId}". This memory connects to ${Math.floor(Math.random() * 5) + 2} other experiences. Would you like me to show you the connections?`);
                }, 800);
            }
        }

        function showNodePreview(e) {
            const node = e.target;
            const preview = document.getElementById('nodePreview');
            const rect = node.getBoundingClientRect();
            
            // Position preview near node
            preview.style.left = (rect.left + rect.width + 10) + 'px';
            preview.style.top = (rect.top - 50) + 'px';
            preview.style.display = 'block';
            
            // Update preview content based on node
            const title = node.getAttribute('title');
            preview.querySelector('.preview-title').textContent = title;
        }

        function hideNodePreview() {
            const preview = document.getElementById('nodePreview');
            preview.style.display = 'none';
        }

        function handleGraphClick(e) {
            // Clear selections when clicking on empty graph
            if (e.target.classList.contains('graph-placeholder') || e.target.classList.contains('graph-content')) {
                selectedNodes.clear();
                document.querySelectorAll('.memory-node').forEach(node => {
                    node.style.transform = '';
                });
            }
        }

        // Filter Functions
        function handleFilterClick(e) {
            const chip = e.target;
            const section = chip.closest('.filter-section');
            
            // Remove active from siblings
            section.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            
            const filterType = section.querySelector('.filter-title').textContent;
            const filterValue = chip.textContent;
            
            console.log('Filter applied:', filterType, filterValue);
            
            // Simulate filter effect
            applyFilter(filterType, filterValue);
        }

        function applyFilter(type, value) {
            // This would integrate with the Neo4j graph to filter nodes
            console.log('Applying filter:', type, value);
            
            // Simulate Winston explaining the filter
            setTimeout(() => {
                addWinstonMessage(`Filtering your memories by ${type}: ${value}. I found ${Math.floor(Math.random() * 20) + 5} matching memories with interesting connections.`);
            }, 500);
        }

        // Time Slider Functions
        function handleTimeChange(e) {
            const value = e.target.value;
            const startYear = 1980;
            const currentYear = new Date().getFullYear();
            const selectedYear = Math.floor(startYear + (value / 100) * (currentYear - startYear));
            
            console.log('Time filter:', selectedYear);
            
            // This would filter the graph by time period
            // Simulate time-based filtering
        }

        // Simulation Functions
        function simulateGraphLoad() {
            const graphContent = document.querySelector('.graph-content');
            graphContent.innerHTML = `
                <div class="graph-icon">üåê</div>
                <div class="graph-text">Memory Graph Ready</div>
                <div class="graph-subtext">47 memories ‚Ä¢ 89 connections ‚Ä¢ 23 people</div>
            `;
            
            // Animate nodes appearing
            const nodes = document.querySelectorAll('.memory-node');
            nodes.forEach((node, index) => {
                setTimeout(() => {
                    node.style.opacity = '0';
                    node.style.animation = 'fadeInScale 0.5s ease forwards';
                }, index * 200);
            });
            
            // Winston welcomes user
            setTimeout(() => {
                addWinstonMessage("Your memory graph is ready! I can see beautiful patterns in your life story. Each golden node represents a memory, and the lines show how they connect. What catches your eye?");
            }, 1000);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: scale(0.5);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
        `;
        document.head.appendChild(style);

        // Track page interaction
        console.log('Explore Screen loaded and interactive');
    </script>
</body>
</html>